<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Streams and Iterators - Rust for Java Developers</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../ferris.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../license.html">License</a></li><li class="chapter-item expanded affix "><a href="../contributing.html">Contributing</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../hello-world/index.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../language/index.html"><strong aria-hidden="true">3.</strong> Language Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/data-types.html"><strong aria-hidden="true">3.1.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="../language/variables-and-constants.html"><strong aria-hidden="true">3.2.</strong> Variables and Constants</a></li><li class="chapter-item expanded "><a href="../language/strings.html"><strong aria-hidden="true">3.3.</strong> Strings</a></li><li class="chapter-item expanded "><a href="../language/collection-types.html"><strong aria-hidden="true">3.4.</strong> Collection Types</a></li><li class="chapter-item expanded "><a href="../language/functions.html"><strong aria-hidden="true">3.5.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../language/control-flow.html"><strong aria-hidden="true">3.6.</strong> Control Flow</a></li><li class="chapter-item expanded "><a href="../language/custom-types/index.html"><strong aria-hidden="true">3.7.</strong> Custom Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/custom-types/classes.html"><strong aria-hidden="true">3.7.1.</strong> Classes</a></li><li class="chapter-item expanded "><a href="../language/custom-types/records.html"><strong aria-hidden="true">3.7.2.</strong> Records</a></li><li class="chapter-item expanded "><a href="../language/custom-types/structs.html"><strong aria-hidden="true">3.7.3.</strong> Structures</a></li><li class="chapter-item expanded "><a href="../language/custom-types/interfaces-and-traits.html"><strong aria-hidden="true">3.7.4.</strong> Interfaces and Traits</a></li><li class="chapter-item expanded "><a href="../language/custom-types/enums.html"><strong aria-hidden="true">3.7.5.</strong> Enumerated Types</a></li><li class="chapter-item expanded "><a href="../language/custom-types/members.html"><strong aria-hidden="true">3.7.6.</strong> Members</a></li></ol></li><li class="chapter-item expanded "><a href="../language/lambdas-and-closures.html"><strong aria-hidden="true">3.8.</strong> Lambdas and Closures</a></li><li class="chapter-item expanded "><a href="../language/streams-and-iterators.html" class="active"><strong aria-hidden="true">3.9.</strong> Streams and Iterators</a></li><li class="chapter-item expanded "><a href="../language/pattern-matching.html"><strong aria-hidden="true">3.10.</strong> Pattern Matching</a></li><li class="chapter-item expanded "><a href="../language/packages-and-modules.html"><strong aria-hidden="true">3.11.</strong> Packages and Modules</a></li><li class="chapter-item expanded "><a href="../language/equality.html"><strong aria-hidden="true">3.12.</strong> Equality</a></li><li class="chapter-item expanded "><a href="../language/generics.html"><strong aria-hidden="true">3.13.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../language/polymorphism.html"><strong aria-hidden="true">3.14.</strong> Polymorphism</a></li><li class="chapter-item expanded "><a href="../language/inheritance.html"><strong aria-hidden="true">3.15.</strong> Inheritance</a></li><li class="chapter-item expanded "><a href="../language/error-handling.html"><strong aria-hidden="true">3.16.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../language/nullability-and-optionality.html"><strong aria-hidden="true">3.17.</strong> Nullability and Optionality</a></li><li class="chapter-item expanded "><a href="../language/conversion-and-casting.html"><strong aria-hidden="true">3.18.</strong> Conversion and Casting</a></li><li class="chapter-item expanded "><a href="../language/annotations.html"><strong aria-hidden="true">3.19.</strong> Annotations</a></li><li class="chapter-item expanded "><a href="../language/smart-pointers.html"><strong aria-hidden="true">3.20.</strong> Smart Pointers</a></li><li class="chapter-item expanded "><a href="../language/documentation-comments.html"><strong aria-hidden="true">3.21.</strong> Documentation Comments</a></li></ol></li><li class="chapter-item expanded "><a href="../memory-management/index.html"><strong aria-hidden="true">4.</strong> Memory Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../memory-management/ownership.html"><strong aria-hidden="true">4.1.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="../memory-management/references-and-lifetimes.html"><strong aria-hidden="true">4.2.</strong> References and Lifetimes</a></li></ol></li><li class="chapter-item expanded "><a href="../resource-management/index.html"><strong aria-hidden="true">5.</strong> Resource Management</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/index.html"><strong aria-hidden="true">6.</strong> Threading and Concurrency</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../threading-and-concurrency/threads.html"><strong aria-hidden="true">6.1.</strong> Threads</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/synchronization.html"><strong aria-hidden="true">6.2.</strong> Synchronization</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/producer-consumer.html"><strong aria-hidden="true">6.3.</strong> Producer-Consumer Pattern</a></li></ol></li><li class="chapter-item expanded "><a href="../testing/index.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../benchmarking/index.html"><strong aria-hidden="true">8.</strong> Benchmarking</a></li><li class="chapter-item expanded "><a href="../logging-and-tracing/index.html"><strong aria-hidden="true">9.</strong> Logging and Tracing</a></li><li class="chapter-item expanded "><a href="../environment-and-configuration/index.html"><strong aria-hidden="true">10.</strong> Environment and Configuration</a></li><li class="chapter-item expanded "><a href="../build-tools/index.html"><strong aria-hidden="true">11.</strong> Build Tools</a></li><li class="chapter-item expanded "><a href="../project-structure/index.html"><strong aria-hidden="true">12.</strong> Project Structure</a></li><li class="chapter-item expanded "><a href="../meta-programming/index.html"><strong aria-hidden="true">13.</strong> Meta Programming</a></li><li class="chapter-item expanded "><a href="../asynchronous-programming/index.html"><strong aria-hidden="true">14.</strong> Asynchronous Programming</a></li><li class="chapter-item expanded affix "><a href="../next-steps.html">Next Steps</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust for Java Developers</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/chrischiedo/rust-for-java-devs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/chrischiedo/rust-for-java-devs/edit/main/src/language/streams-and-iterators.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="streams-and-iterators"><a class="header" href="#streams-and-iterators">Streams and Iterators</a></h1>
<p>This section discusses Java's <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/util/stream/Stream.html">Stream API</a> within the context and for the purpose of transforming sequences (<code>Iterator&lt;E&gt;</code>/<code>Iterable&lt;T&gt;</code>) and typically collections like lists, sets and maps.</p>
<h2 id="iterablet-interface"><a class="header" href="#iterablet-interface"><code>Iterable&lt;T&gt; Interface</code></a></h2>
<p>The equivalent of Java's <code>Iterable&lt;T&gt;</code> in Rust is <a href="https://doc.rust-lang.org/std/iter/trait.IntoIterator.html"><code>IntoIterator</code></a>.
Just as an implementation of <code>Iterable&lt;T&gt;.iterator()</code> returns a
<code>Iterator&lt;T&gt;</code> in Java, an implementation of <code>IntoIterator::into_iter</code>
returns an <a href="https://doc.rust-lang.org/core/iter/trait.Iterator.html"><code>Iterator</code></a>. However, when it's time to iterate over the
items of a container advertising iteration support through the said types,
both languages offer syntactic sugar in the form of looping constructs for
iteratables. In Java, there is the enhanced <code>for</code> statement (also known as the <code>for-each</code> loop).</p>
<pre><code class="language-java">int[] values = { 1, 2, 3, 4, 5 };

StringBuilder output = new StringBuilder();

for (var value : values) {
    if (output.length() &gt; 0) {
        output.append(&quot;, &quot;);
    }
    output.append(value);
}

System.out.println(output); // prints: 1, 2, 3, 4, 5
</code></pre>
<p>In Rust, the equivalent is simply <code>for</code>:</p>
<pre><code class="language-rust">use std::fmt::Write;

fn main() {
    let values = [1, 2, 3, 4, 5];
    let mut output = String::new();

    for value in values {
        if output.len() &gt; 0 {
            output.push_str(&quot;, &quot;);
        }
        // ! discard/ignore any write error
        _ = write!(output, &quot;{value}&quot;);
    }

    println!(&quot;{output}&quot;);  // Prints: 1, 2, 3, 4, 5
}</code></pre>
<p>The <code>for</code> loop over an iterable essentially gets desugared to the following:</p>
<pre><code class="language-rust">use std::fmt::Write;

fn main() {
    let values = [1, 2, 3, 4, 5];
    let mut output = String::new();

    let mut iter = values.into_iter();      // get iterator
    while let Some(value) = iter.next() {   // loop as long as there are more items
        if output.len() &gt; 0 {
            output.push_str(&quot;, &quot;);
        }
        _ = write!(output, &quot;{value}&quot;);
    }

    println!(&quot;{output}&quot;);
}</code></pre>
<p>Here's a Java example that uses the <code>forEach()</code> method:</p>
<pre><code class="language-java">Map&lt;String, String&gt; houses = new HashMap&lt;&gt;(Map.of(
                &quot;Stark&quot;, &quot;Winter Is Coming&quot;,
                &quot;Targaryen&quot;, &quot;Fire and Blood&quot;,
                &quot;Lannister&quot;, &quot;Hear Me Roar&quot;,
                &quot;Arryn&quot;, &quot;As High as Honor&quot;,
                &quot;Tully&quot;, &quot;Family, Duty, Honor&quot;,
                &quot;Greyjoy&quot;, &quot;We Do Not Sow&quot;,
                &quot;Baratheon&quot;, &quot;Ours is the Fury&quot;,
                &quot;Tyrell&quot;, &quot;Growing Strong&quot;,
                &quot;Martell&quot;, &quot;Unbowed, Unbent, Unbroken&quot;,
                &quot;Hightower&quot;, &quot;We Light the Way&quot;
                ));

houses.entrySet()
        .stream()
        .forEach(house -&gt; System.out.println(
                          &quot;House: &quot; + house.getKey() 
                                    + &quot;,&quot; + &quot; Motto: &quot;
                                    + house.getValue()));

</code></pre>
<p>The output looks as follows:</p>
<pre><code>House: Lannister, Motto: Hear Me Roar
House: Targaryen, Motto: Fire and Blood
House: Baratheon, Motto: Ours is the Fury
House: Hightower, Motto: We Light the Way
House: Martell, Motto: Unbowed, Unbent, Unbroken
House: Tyrell, Motto: Growing Strong
House: Tully, Motto: Family, Duty, Honor
House: Stark, Motto: Winter Is Coming
House: Arryn, Motto: As High as Honor
House: Greyjoy, Motto: We Do Not Sow
</code></pre>
<p>Here's the Rust equivalent:</p>
<pre><code class="language-rust">use std::collections::HashMap;

fn main() {

    let houses = HashMap::from([
            (&quot;Stark&quot;.to_owned(), &quot;Winter Is Coming&quot;.to_owned()),
            (&quot;Targaryen&quot;.to_owned(), &quot;Fire and Blood&quot;.to_owned()),
            (&quot;Lannister&quot;.to_owned(), &quot;Hear Me Roar&quot;.to_owned()),
            (&quot;Arryn&quot;.to_owned(), &quot;As High as Honor&quot;.to_owned()),
            (&quot;Tully&quot;.to_owned(), &quot;Family, Duty, Honor&quot;.to_owned()),
            (&quot;Greyjoy&quot;.to_owned(), &quot;We Do Not Sow&quot;.to_owned()),
            (&quot;Baratheon&quot;.to_owned(), &quot;Ours is the Fury&quot;.to_owned()),
            (&quot;Tyrell&quot;.to_owned(), &quot;Growing Strong&quot;.to_owned()),
            (&quot;Martell&quot;.to_owned(), &quot;Unbowed, Unbent, Unbroken&quot;.to_owned()),
            (&quot;Hightower&quot;.to_owned(), &quot;We Light the Way&quot;.to_owned())
    ]);


    for (key, value) in houses.iter() {
        println!(&quot;House: {}, Motto: {}&quot;, key, value);
    }
}</code></pre>
<p>The output for the Rust version looks as follows:</p>
<pre><code>House: Baratheon, Motto: Ours is the Fury
House: Stark, Motto: Winter Is Coming
House: Targaryen, Motto: Fire and Blood
House: Martell, Motto: Unbowed, Unbent, Unbroken
House: Lannister, Motto: Hear Me Roar
House: Tyrell, Motto: Growing Strong
House: Arryn, Motto: As High as Honor
House: Tully, Motto: Family, Duty, Honor
House: Hightower, Motto: We Light the Way
House: Greyjoy, Motto: We Do Not Sow
</code></pre>
<p>Rust's ownership and data race condition rules apply to all instances and
data, and iteration is no exception. So while looping over an array might look
straightforward and very similar to Java, one has to be mindful about ownership
when needing to iterate the same collection/iterable more than once. The
following example iterates the list of integers twice, once to print their sum
and another time to determine and print the maximum integer:</p>
<pre><code class="language-rust">fn main() {
    let values = vec![1, 2, 3, 4, 5];

    // sum all values
    let mut sum = 0;
    for value in values {
        sum += value;
    }
    println!(&quot;sum = {sum}&quot;);

    // determine maximum value
    let mut max = None;
    for value in values {
        if let Some(some_max) = max { // if max is defined
            if value &gt; some_max {     // and value is greater
                max = Some(value)     // then note that new max
            }
        } else {                      // max is undefined when iteration starts
            max = Some(value)         // so set it to the first value
        }
    }
    println!(&quot;max = {max:?}&quot;);
}</code></pre>
<p>However, the code above is rejected by the compiler due to a subtle
difference: <code>values</code> has been changed from an array to a <a href="https://doc.rust-lang.org/stable/std/vec/struct.Vec.html"><code>Vec&lt;int&gt;</code></a>,
a <em>vector</em>, which is Rust's type for growable arrays (like <code>List&lt;E&gt;</code> in Java).
The first iteration of <code>values</code> ends up <em>consuming</em> each value as the integers
are summed up. In other words, the ownership of <em>each item</em> in the vector
passes to the iteration variable of the loop: <code>value</code>. Since <code>value</code> goes out
of scope at the end of each iteration of the loop, the instance it owns is
dropped. Had <code>values</code> been a vector of heap-allocated data, the heap memory
backing each item would get freed as the loop moved to the next item. To fix
the problem, one has to request iteration over <em>shared</em> references via
<code>&amp;values</code> in the <code>for</code> loop. As a result, <code>value</code> ends up being a shared
reference to an item as opposed to taking its ownership.</p>
<p>Below is the updated version of the previous example that compiles. The fix is
to simply replace <code>values</code> with <code>&amp;values</code> in each of the <code>for</code> loops.</p>
<pre><code class="language-rust">fn main() {
    let values = vec![1, 2, 3, 4, 5];

    // sum all values
    let mut sum = 0;
    for value in &amp;values {
        sum += value;
    }
    println!(&quot;sum = {sum}&quot;);

    // determine maximum value
    let mut max = None;
    for value in &amp;values {
        if let Some(some_max) = max { // if max is defined
            if value &gt; some_max {     // and value is greater
                max = Some(value)     // then note that new max
            }
        } else {                      // max is undefined when iteration starts
            max = Some(value)         // so set it to the first value
        }
    }
    println!(&quot;max = {max:?}&quot;);
}</code></pre>
<p>The ownership and dropping can be seen in action even with <code>values</code> being an
array instead of a vector. Consider just the summing loop from the above
example over an array of a structure that wraps an integer:</p>
<pre><code class="language-rust">#[derive(Debug)]
struct Int(i32);

impl Drop for Int {
    fn drop(&amp;mut self) {
        println!(&quot;Int({}) dropped&quot;, self.0)
    }
}

fn main() {
    let values = [Int(1), Int(2), Int(3), Int(4), Int(5)];
    let mut sum = 0;

    for value in values {
        println!(&quot;value = {value:?}&quot;);
        sum += value.0;
    }

    println!(&quot;sum = {sum}&quot;);
}</code></pre>
<p><code>Int</code> implements <code>Drop</code> so that a message is printed when an instance get
dropped. Running the above code will print:</p>
<pre><code>value = Int(1)
Int(1) dropped
value = Int(2)
Int(2) dropped
value = Int(3)
Int(3) dropped
value = Int(4)
Int(4) dropped
value = Int(5)
Int(5) dropped
sum = 15
</code></pre>
<p>It's clear that each value is acquired and dropped while the loop is running.
Once the loop is complete, the sum is printed. If <code>values</code> in the <code>for</code> loop
is changed to <code>&amp;values</code> instead, like this:</p>
<pre><code class="language-rust">for value in &amp;values {
    // ...
}</code></pre>
<p>then the output of the program will change radically:</p>
<pre><code>value = Int(1)
value = Int(2)
value = Int(3)
value = Int(4)
value = Int(5)
sum = 15
Int(1) dropped
Int(2) dropped
Int(3) dropped
Int(4) dropped
Int(5) dropped
</code></pre>
<p>This time, values are acquired but not dropped while looping because each item
doesn't get owned by the interation loop's variable. The sum is printed ocne
the loop is done. Finally, when the <code>values</code> array that still owns all the the
<code>Int</code> instances goes out of scope at the end of <code>main</code>, its dropping in turn
drops all the <code>Int</code> instances.</p>
<p>These examples demonstrate that while iterating collection types may seem to
have a lot of parallels between Rust and Java, from the looping constructs to
the iteration abstractions, there are still subtle differences with respect to
ownership that can lead to the compiler rejecting the code in some instances.</p>
<p>See also:</p>
<ul>
<li><a href="https://doc.rust-lang.org/std/iter/index.html">Iterator</a></li>
<li><a href="https://doc.rust-lang.org/std/iter/index.html#iterating-by-reference">Iterating by reference</a></li>
</ul>
<h2 id="stream-operations"><a class="header" href="#stream-operations">Stream Operations</a></h2>
<p>Java's Stream API offers a set of <em>operations</em> (methods) that can be chained together to form stream <em>pipelines</em>. In Rust, such methods are called <em><a href="https://doc.rust-lang.org/std/iter/index.html#adapters">adapters</a></em>.</p>
<p>However, while rewriting an imperative loop as a stream in Java is often beneficial in expressivity, robustness and composability, there is a trade-off with performance. Compute-bound imperative loops <em>usually</em> run faster because they can be optimised by the JIT compiler and there are fewer virtual dispatches or indirect function invocations incurred. The surprising part in Rust is that there is no performance trade-off between choosing to use method chains on an abstraction like an iterator over writing an imperative loop by hand. It's therefore far more common to see the former in code.</p>
<p>The following table lists the most common Stream API methods and their approximate
counterparts in Rust.</p>
<div class="table-wrapper"><table><thead><tr><th>Java</th><th>Rust</th><th>Note</th></tr></thead><tbody>
<tr><td><code>reduce</code></td><td><code>reduce</code></td><td>See note 1.</td></tr>
<tr><td><code>reduce</code></td><td><code>fold</code></td><td>See note 1.</td></tr>
<tr><td><code>allMatch</code></td><td><code>all</code></td><td></td></tr>
<tr><td><code>anyMatch</code></td><td><code>any</code></td><td></td></tr>
<tr><td><code>concat</code></td><td><code>chain</code></td><td></td></tr>
<tr><td><code>count</code></td><td><code>count</code></td><td></td></tr>
<tr><td><code>max</code></td><td><code>max</code></td><td></td></tr>
<tr><td><code>min</code></td><td><code>min</code></td><td></td></tr>
<tr><td><code>map</code></td><td><code>map</code></td><td></td></tr>
<tr><td><code>flatMap</code></td><td><code>flat_map</code></td><td></td></tr>
<tr><td><code>skip</code></td><td><code>skip</code></td><td></td></tr>
<tr><td><code>limit</code></td><td><code>take</code></td><td></td></tr>
<tr><td><code>takeWhile</code></td><td><code>take_while</code></td><td></td></tr>
<tr><td><code>collect</code></td><td><code>collect</code></td><td>See note 2.</td></tr>
<tr><td><code>filter</code></td><td><code>filter</code></td><td></td></tr>
</tbody></table>
</div>
<ol>
<li>
<p>Java's <code>reduce</code> method is overloaded. The one not accepting an identity value is 
equivalent to Rust's <code>reduce</code>, while the one accepting an identity value corresponds
to Rust's <code>fold</code>.</p>
</li>
<li>
<p><a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html#method.collect"><code>collect</code></a> in Rust generally works for any collectible type,
which is defined as <a href="https://doc.rust-lang.org/stable/std/iter/trait.FromIterator.html">a type that can initialize itself from an iterator
(see <code>FromIterator</code>)</a>. <code>collect</code> needs a target type, which
the compiler sometimes has trouble inferring so the <em>turbofish</em> (<code>::&lt;&gt;</code>) is
often used in conjunction with it, as in <code>collect::&lt;Vec&lt;_&gt;&gt;()</code>.</p>
</li>
</ol>
<p>The following example shows how similar transforming sequences in Java is to
doing the same in Rust. First in Java:</p>
<pre><code class="language-java">int result = IntStream.range(0, 10)
                .filter(x -&gt; x % 2 == 0)
                .flatMap(x -&gt; IntStream.range(0, x))
                .reduce(0, Integer::sum);

System.out.println(result); // prints: 50
</code></pre>
<p>And in Rust:</p>
<pre><code class="language-rust">let result = (0..10)
    .filter(|x| x % 2 == 0)
    .flat_map(|x| (0..x))
    .fold(0, |acc, x| acc + x);

println!(&quot;{result}&quot;); // prints: 50</code></pre>
<h2 id="deferred-execution-laziness"><a class="header" href="#deferred-execution-laziness">Deferred execution (laziness)</a></h2>
<p>Java streams are lazy: computation on the source data is only performed when a 
<em>terminal operation</em> is initiated, and source elements are consumed only as needed. This enables composition or chaining of several (<em>intermediate</em>) operations/methods without causing any side-effects. For example, a stream operation can return an <code>Iterable&lt;T&gt;</code> that is initialized, but does not produce, compute or materialize any items of <code>T</code> until iterated. The operation is said to have <em>deferred execution</em> semantics (or <em>lazy evaluation</em>). If each <code>T</code> is computed as iteration reaches it (as opposed to when iteration begins) then the operation is said to <em>stream</em> the results.</p>
<p>Rust iterators have the same concept of <a href="https://doc.rust-lang.org/std/iter/index.html#laziness"><em>laziness</em></a> and
streaming.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../language/lambdas-and-closures.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../language/pattern-matching.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../language/lambdas-and-closures.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../language/pattern-matching.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../ferris.js"></script>


    </body>
</html>
