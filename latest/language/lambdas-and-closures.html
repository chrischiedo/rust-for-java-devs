<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lambdas and Closures - Rust for Java Developers</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../ferris.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="../license.html">License</a></li><li class="chapter-item expanded affix "><a href="../contributing.html">Contributing</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../hello-world/index.html"><strong aria-hidden="true">2.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../language/index.html"><strong aria-hidden="true">3.</strong> Language Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/data-types.html"><strong aria-hidden="true">3.1.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="../language/variables-and-constants.html"><strong aria-hidden="true">3.2.</strong> Variables and Constants</a></li><li class="chapter-item expanded "><a href="../language/strings.html"><strong aria-hidden="true">3.3.</strong> Strings</a></li><li class="chapter-item expanded "><a href="../language/collection-types.html"><strong aria-hidden="true">3.4.</strong> Collection Types</a></li><li class="chapter-item expanded "><a href="../language/functions.html"><strong aria-hidden="true">3.5.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../language/control-flow.html"><strong aria-hidden="true">3.6.</strong> Control Flow</a></li><li class="chapter-item expanded "><a href="../language/custom-types/index.html"><strong aria-hidden="true">3.7.</strong> Custom Types</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../language/custom-types/classes.html"><strong aria-hidden="true">3.7.1.</strong> Classes</a></li><li class="chapter-item expanded "><a href="../language/custom-types/records.html"><strong aria-hidden="true">3.7.2.</strong> Records</a></li><li class="chapter-item expanded "><a href="../language/custom-types/structs.html"><strong aria-hidden="true">3.7.3.</strong> Structures</a></li><li class="chapter-item expanded "><a href="../language/custom-types/interfaces-and-traits.html"><strong aria-hidden="true">3.7.4.</strong> Interfaces and Traits</a></li><li class="chapter-item expanded "><a href="../language/custom-types/enums.html"><strong aria-hidden="true">3.7.5.</strong> Enumerated Types</a></li><li class="chapter-item expanded "><a href="../language/custom-types/members.html"><strong aria-hidden="true">3.7.6.</strong> Members</a></li></ol></li><li class="chapter-item expanded "><a href="../language/lambdas-and-closures.html" class="active"><strong aria-hidden="true">3.8.</strong> Lambdas and Closures</a></li><li class="chapter-item expanded "><a href="../language/streams-and-iterators.html"><strong aria-hidden="true">3.9.</strong> Streams and Iterators</a></li><li class="chapter-item expanded "><a href="../language/pattern-matching.html"><strong aria-hidden="true">3.10.</strong> Pattern Matching</a></li><li class="chapter-item expanded "><a href="../language/packages-and-modules.html"><strong aria-hidden="true">3.11.</strong> Packages and Modules</a></li><li class="chapter-item expanded "><a href="../language/equality.html"><strong aria-hidden="true">3.12.</strong> Equality</a></li><li class="chapter-item expanded "><a href="../language/generics.html"><strong aria-hidden="true">3.13.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../language/polymorphism.html"><strong aria-hidden="true">3.14.</strong> Polymorphism</a></li><li class="chapter-item expanded "><a href="../language/inheritance.html"><strong aria-hidden="true">3.15.</strong> Inheritance</a></li><li class="chapter-item expanded "><a href="../language/error-handling.html"><strong aria-hidden="true">3.16.</strong> Error Handling</a></li><li class="chapter-item expanded "><a href="../language/nullability-and-optionality.html"><strong aria-hidden="true">3.17.</strong> Nullability and Optionality</a></li><li class="chapter-item expanded "><a href="../language/conversion-and-casting.html"><strong aria-hidden="true">3.18.</strong> Conversion and Casting</a></li><li class="chapter-item expanded "><a href="../language/annotations.html"><strong aria-hidden="true">3.19.</strong> Annotations</a></li><li class="chapter-item expanded "><a href="../language/smart-pointers.html"><strong aria-hidden="true">3.20.</strong> Smart Pointers</a></li><li class="chapter-item expanded "><a href="../language/documentation-comments.html"><strong aria-hidden="true">3.21.</strong> Documentation Comments</a></li></ol></li><li class="chapter-item expanded "><a href="../memory-management/index.html"><strong aria-hidden="true">4.</strong> Memory Management</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../memory-management/ownership.html"><strong aria-hidden="true">4.1.</strong> Ownership</a></li><li class="chapter-item expanded "><a href="../memory-management/references-and-lifetimes.html"><strong aria-hidden="true">4.2.</strong> References and Lifetimes</a></li></ol></li><li class="chapter-item expanded "><a href="../resource-management/index.html"><strong aria-hidden="true">5.</strong> Resource Management</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/index.html"><strong aria-hidden="true">6.</strong> Threading and Concurrency</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../threading-and-concurrency/threads.html"><strong aria-hidden="true">6.1.</strong> Threads</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/synchronization.html"><strong aria-hidden="true">6.2.</strong> Synchronization</a></li><li class="chapter-item expanded "><a href="../threading-and-concurrency/producer-consumer.html"><strong aria-hidden="true">6.3.</strong> Producer-Consumer Pattern</a></li></ol></li><li class="chapter-item expanded "><a href="../testing/index.html"><strong aria-hidden="true">7.</strong> Testing</a></li><li class="chapter-item expanded "><a href="../benchmarking/index.html"><strong aria-hidden="true">8.</strong> Benchmarking</a></li><li class="chapter-item expanded "><a href="../logging-and-tracing/index.html"><strong aria-hidden="true">9.</strong> Logging and Tracing</a></li><li class="chapter-item expanded "><a href="../environment-and-configuration/index.html"><strong aria-hidden="true">10.</strong> Environment and Configuration</a></li><li class="chapter-item expanded "><a href="../build-tools/index.html"><strong aria-hidden="true">11.</strong> Build Tools</a></li><li class="chapter-item expanded "><a href="../project-structure/index.html"><strong aria-hidden="true">12.</strong> Project Structure</a></li><li class="chapter-item expanded "><a href="../meta-programming/index.html"><strong aria-hidden="true">13.</strong> Meta Programming</a></li><li class="chapter-item expanded "><a href="../asynchronous-programming/index.html"><strong aria-hidden="true">14.</strong> Asynchronous Programming</a></li><li class="chapter-item expanded affix "><a href="../next-steps.html">Next Steps</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Rust for Java Developers</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/chrischiedo/rust-for-java-devs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/chrischiedo/rust-for-java-devs/edit/main/src/language/lambdas-and-closures.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lambdas-and-closures"><a class="header" href="#lambdas-and-closures">Lambdas and Closures</a></h1>
<p>Java has a feature for defining anonymous functions in the form of 
<em>lambda expressions</em><sup class="footnote-reference"><a href="#lambda">1</a></sup>. The syntax for a lambda expression in Java looks as follows:</p>
<pre><code> ( paramlist ) -&gt; { /* method body */ }
</code></pre>
<p>In Rust, anonymous functions are called <em>closures</em>. The syntax for a closure expression in Rust looks as follows:</p>
<pre><code> | paramlist | { /* function body */ }
</code></pre>
<blockquote>
<p>Note: In both Java and Rust, the types of the parameters will typically be inferred.</p>
</blockquote>
<p>In addition to closures, Rust has <em>function pointers</em> that implement all three of the closure traits (<code>Fn</code>, <code>FnMut</code> and <code>FnOnce</code>). Rust makes a distinction between function pointers (where <code>fn</code>
defines a type) and closures: a closure can reference variables from its surrounding lexical scope, but not a function pointer.</p>
<p>While Java doesn't have function pointers, it provides a set of functional interfaces (in the <code>java.util.function</code> package) that can be used as target types for lambda expressions (and method references). You can also define your own functional interfaces as well (as we do in the Java code example below).</p>
<p>In Rust, functions and methods that accept closures are written with generic types that
are bound to one of the closure traits: <code>Fn</code>, <code>FnMut</code> and <code>FnOnce</code>. When it's time to provide a value for a function pointer or a closure, you would use a <em>closure expression</em> (like <code>|x| x + 1</code>), which translates to something similar to a lambda expression in Java. Whether the closure expression creates a function pointer or a closure depends on whether the closure expression references its context or not.</p>
<p>When a closure captures variables from its environment then ownership rules come into play because the ownership ends up with the closure. For more information, see the “<a href="https://doc.rust-lang.org/book/ch13-01-closures.html#moving-captured-values-out-of-closures-and-the-fn-traits">Moving Captured Values Out of Closures and the Fn Traits</a>” section of the Rust book.</p>
<p>Let's look at a Rust example that showcases all these functionalities:</p>
<pre><code class="language-rust">struct Customer {
    name: String,
    gross_income: f64,
}

impl Customer {
    pub fn new(name: String, gross_income: f64) -&gt; Self {
        Self { name, gross_income }
    }
    
    pub fn name(&amp;self) -&gt; String {
        self.name.clone()
    }
    
    pub fn gross_income(&amp;self)  -&gt; f64 {
        self.gross_income
    }
}

// Note: the parameter func is of type fn, which is a function pointer
fn apply_tax_calc_function(func: fn(f64) -&gt; f64, arg: f64) -&gt; f64 {
    func(arg)
}

fn main() {
    let customer = Customer::new(&quot;Jane Doe&quot;.to_string(), 50000 as f64);

    let name = customer.name();
    let income = customer.gross_income();

    let tax_function_closure = |income| {
        let payable_tax: f64;
        if income &lt; 30000 as f64 {
            payable_tax = income * 0.05;
        } else {
            payable_tax = income * 0.06;
        }
        payable_tax
    };

    let calculated_tax = apply_tax_calc_function(tax_function_closure, income); // we pass in a closure

    println!(&quot;The calculated tax for {} is {}&quot;, name, calculated_tax); // prints: The calculated tax for Jane Doe is 3000
}</code></pre>
<p>Here's how we can achieve the equivalent functionality in Java:</p>
<pre><code class="language-java">// we define our own functional interface
@FunctionalInterface
interface TaxFunction {
    double calculateTax(double grossIncome);
}

record Customer(String name, double grossIncome) {

    public double applyTaxCalcFunction(TaxFunction taxFunc) {
        double calculatedTax = taxFunc.calculateTax(grossIncome);
        return calculatedTax;
    }
}

public class TestClass {

    public static void main(String[] args) {

          // define a function as a lambda expression and assign the result to a variable
          TaxFunction taxFunction = (grossIncome) -&gt; {
              double payableTax;

              if (grossIncome &lt; 30000) {
                  payableTax = grossIncome * 0.05;
              } else {
                  payableTax = grossIncome * 0.06;
              }

              return payableTax;
          };

          Customer customer = new Customer(&quot;Jane Doe&quot;, 50000);

          String name = customer.name();

          double calculatedTax = customer.applyTaxCalcFunction(taxFunction); // we pass in a lambda expression

          System.out.println(&quot;The calculated tax for &quot; + name + &quot; is &quot;+ calculatedTax); // prints: The calculated tax for Jane Doe is 3000.0
    }
}
</code></pre>
<h2 id="higher-order-functions"><a class="header" href="#higher-order-functions">Higher-order functions</a></h2>
<p>Higher-order functions are functions that accept other functions as arguments to allow for the caller to participate in the code of the called function. As we've already seen in the code examples above, in both Rust and Java, we can pass closures and lambda expressions to functions. But unlike in Java, Rust also allows <em>regular functions</em> to be passed into other functions:</p>
<pre><code class="language-rust">struct Customer {
    name: String,
    gross_income: f64,
}

impl Customer {
    pub fn new(name: String, gross_income: f64) -&gt; Self {
        Self { name, gross_income }
    }
    
    pub fn name(&amp;self) -&gt; String {
        self.name.clone()
    }
    
    pub fn gross_income(&amp;self)  -&gt; f64 {
        self.gross_income
    }
}

// Note: the parameter func is of type fn, which is a function pointer
fn apply_tax_calc_function(func: fn(f64) -&gt; f64, arg: f64) -&gt; f64 {
    func(arg)
}

// define a regular function
fn tax_function_regular(income: f64) -&gt; f64 {
    let payable_tax: f64;
    if income &lt; 30000 as f64 {
        payable_tax = income * 0.05;
    } else {
        payable_tax = income * 0.06;
    }
    payable_tax
}

fn main() {
    let customer = Customer::new(&quot;Jane Doe&quot;.to_string(), 50000 as f64);

    let name = customer.name();
    let income = customer.gross_income();

    let calculated_tax = apply_tax_calc_function(tax_function_regular, income); // we pass in a regular function

    println!(&quot;The calculated tax for {} is {}&quot;, name, calculated_tax); // prints: The calculated tax for Jane Doe is 3000
}</code></pre>
<hr />
<div class="footnote-definition" id="lambda"><sup class="footnote-definition-label">1</sup>
<p>Lambda expressions were introduced in Java 8.</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../language/custom-types/members.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../language/streams-and-iterators.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../language/custom-types/members.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../language/streams-and-iterators.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../ferris.js"></script>


    </body>
</html>
